<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
  />
  <title>IOUL</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- existing markup -->
  <div class="account-wrapper">…</div>
  <div class="help-wrapper">…</div>
  <div class="layer-one"></div>
  <div class="layer-two"></div>

  <script>
    let inactivityTimer;
    let fadeCompleted = false;
    let initialHoverTriggered = false;
    let lastMouseEvent = null;
    let inputInFocus = false;

    let accountTransitionComplete = false;
    let helpTransitionComplete = false;

    const accountWrapper = document.querySelector('.account-wrapper');
    const helpWrapper = document.querySelector('.help-wrapper');

    accountWrapper.addEventListener('transitionend', function(e) {
      if (e.propertyName === 'left' && accountWrapper.classList.contains('active')) {
        accountTransitionComplete = true;
      }
    });

    helpWrapper.addEventListener('transitionend', function(e) {
      if (e.propertyName === 'left' && helpWrapper.classList.contains('active')) {
        helpTransitionComplete = true;
      }
    });

    function hideLoginElements() {
      document.querySelectorAll('.login-text, .login-line, .login-line-second').forEach(el => {
        el.classList.add('reverse-slide');
        el.addEventListener('animationend', function() {
          el.classList.remove('reverse-slide', 'slide-left');
        }, { once: true });
      });
    }

    function resetInactivityTimer() {
      if (inactivityTimer) clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(hideLoginElements, 20000);
    }

    function checkRegionAndShowOpenHelp(event) {
      // existing region-check & show “open help” logic
    }

    // --- Fullscreen only on edge-click ---
    document.addEventListener('click', event => {
      const edgeThreshold = 10;
      const { clientX, clientY } = event;
      const { innerWidth, innerHeight } = window;
      const isNearEdge =
        clientX <= edgeThreshold ||
        clientX >= innerWidth - edgeThreshold ||
        clientY <= edgeThreshold ||
        clientY >= innerHeight - edgeThreshold;

      if (isNearEdge && !document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      }
    });

    // --- One-time hover (mouseover) to trigger the initial fade-in ---
    function onFirstHover(e) {
      if (initialHoverTriggered) return;
      initialHoverTriggered = true;

      setTimeout(() => {
        document.body.classList.add('fade-in-trigger');
      }, 1000);

      setTimeout(() => {
        fadeCompleted = true;
        inactivityTimer = setTimeout(hideLoginElements, 20000);
      }, 4000);
    }

    document.body.addEventListener('mouseover', onFirstHover, { once: true });

    // --- Rest of existing mousemove handler ---
    document.addEventListener('mousemove', event => {
      lastMouseEvent = event;
      resetInactivityTimer();
      checkRegionAndShowOpenHelp(event);
    });

    function addLoginClickHandler(element) {
      element.addEventListener('click', function() {
        if (fadeCompleted &&
            (this.classList.contains('username') || this.classList.contains('password'))) {
          const parentRect = this.getBoundingClientRect();
          const input = document.createElement('input');
          input.type = this.classList.contains('password') ? 'password' : 'text';
          input.maxLength = 10;
          input.className = 'typing-input';
          input.style.top = `${parentRect.top + window.scrollY}px`;
          input.style.left = `${parentRect.left + window.scrollX}px`;
          input.style.width = `${parentRect.width}px`;
          document.body.appendChild(input);
          input.focus();
          inputInFocus = true;
        }
      });
    }

    document.querySelectorAll('.login-text, .login-line, .login-line-second')
      .forEach(addLoginClickHandler);
  </script>
</body>
</html>
