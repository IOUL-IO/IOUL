<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>IOUL</title>
<link href="favicon.png" rel="icon" type="image/png"/>
<link href="styles.css" rel="stylesheet"/>
<style>
  /* inline tweaks for login fonts (unchanged) */
  .login-text{
    position:absolute;
    z-index:10;
    overflow:visible;
    font-family:'Distill Expanded',sans-serif;
    color:#111;
    letter-spacing:.34vw;
    font-size:.46rem;
    line-height:1.2;
    padding:.1rem 0;
    text-shadow:.001rem .001rem 0 #717171,-.001rem -.001rem 0 #717171;
  }
  input.typing-input{
    font-family:'Distill Expanded',sans-serif;font-size:.46rem;line-height:1.2;
    color:#111;letter-spacing:.34vw;border:none;outline:none;background:transparent;
    position:absolute;caret-color:#717171;padding:.1rem 0;width:calc(22.48vw + 4vw);
    text-shadow:.001rem .001rem 0 #717171,-.007rem -.001rem 0 #717171;text-align:left;
  }
  .help-text-area.sendlink{opacity:.7;transition:opacity .3s ease;margin-top:-.05rem;}
  .help-text-area.sendlink:hover{opacity:1;}
</style>
</head>

<body class="non-fullscreen stage-login">
  <!-- Static lines -->
  <div class="line original"></div>
  <div class="line second"></div>
  <div class="line third"></div>
  <div class="line fourth"></div>
  <div class="line fifth"></div>
  <div class="line sixth"></div>
  <div class="line util-line"></div>

  <!-- Login -->
  <span class="login-text username hidden">USERnAME</span>
  <span class="login-text password hidden">PASSWORD</span>

  <!-- Util texts -->
  <span class="login-text open-text hidden">OPEn</span>
  <span class="login-text help-text hidden">HELP</span>

  <!-- Login entry lines -->
  <div class="line login-line hidden"></div>
  <div class="line login-line-second hidden"></div>

  <!-- Account creation wrapper -->
  <div class="account-wrapper">
    <span class="account-text account-email">E-MA1L ADDRESS</span>
    <span class="account-text account-username">YOUR USERnAME</span>
    <span class="account-text account-sign-password">YOUR PASSWORD</span>
    <span class="account-text account-repeat-password">REDO PASSWORD</span>
    <div class="account-line account-line1"></div>
    <div class="account-line account-line2"></div>
    <div class="account-line account-line3"></div>
    <div class="account-line account-line4"></div>
  </div>

  <!-- Help wrapper -->
  <div class="help-wrapper">
    <span class="help-text-area email">YOUR EMA1L</span>
    <span class="help-text-area sendlink">SEnD L1nK</span>
    <div class="help-line"></div>
  </div>

  <!-- Masking layers -->
  <div class="layer-one"></div>
  <div class="layer-two"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ===== Element groups ===== */
  const loginEls    = document.querySelectorAll('.username, .password, .login-line, .login-line-second');
  const utilLine    = document.querySelector('.util-line');
  const openText    = document.querySelector('.open-text');
  const helpText    = document.querySelector('.help-text');
  const accountWrap = document.querySelector('.account-wrapper');
  const helpWrap    = document.querySelector('.help-wrapper');
  const body        = document.body;

  /* ===== Helper functions ===== */
  const fadeInEls  = (els) => els.forEach(el => { el.classList.remove('hidden'); el.classList.add('visible'); });
  const fadeOutEls = (els) => Promise.all(Array.from(els).map(el => new Promise(res => {
      if (!el.classList.contains('visible')) { res(); return; }
      const end = (e)=>{ if(e.propertyName==='opacity'){ el.removeEventListener('transitionend', end); res(); } };
      el.addEventListener('transitionend', end);
      el.classList.add('hidden'); el.classList.remove('visible');
  })));

  /* ===== Stage management ===== */
  function setStage(name){
    body.classList.remove('stage-login','stage-util','stage-account','stage-help');
    body.classList.add(name);
  }

  /* ===== Initial hover logic (unchanged) ===== */
  let phase = 0; // 0: waiting for first pointer -> lines fade. 1: waiting for login zone hover
  function inLoginZone(x,y){
      const vw=innerWidth, vh=innerHeight;
      return x>=vw*0.0641 && x<=vw*0.2886 && y>=vh*0.285 && y<=vh*0.84;
  }
  function initialPointer(e){
      const p=e.touches?e.touches[0]:e;
      const {clientX:x, clientY:y}=p;

      if(phase===0){
          document.body.classList.add('fade-in-trigger'); // lines & util fade in
          phase=1;
          return;
      }
      if(phase===1 && inLoginZone(x,y)){
          fadeInEls(loginEls);                            // login group fade in
          phase=2;
          window.removeEventListener('pointermove',initialPointer);
          window.removeEventListener('touchstart',initialPointer);
      }
  }
  window.addEventListener('pointermove', initialPointer, {passive:true});
  window.addEventListener('touchstart', initialPointer, {passive:true});

  /* ===== Sequential logic ===== */
  let step = 0; // 0: login, 1: util, 2: account, 3: help

  
  
  utilLine.addEventListener('click', () => {
      if(step!==0) return;
      /* Phase 1: slide login items left */
      setStage('stage-util-pre');
      fadeInEls(loginEls);
      step = 1;
      /* Phase 2 after slide completes */
      setTimeout(() => {
          fadeInEls([openText, helpText]);
          body.classList.remove('stage-util-pre'); // remove pre-stage so util rules win
          setStage('stage-util');
      }, 700);
  });



  openText.addEventListener('click', () => {
      if(step!==1) return;
      accountWrap.classList.add('active');
      setStage('stage-account');
      step=2;
  });

  helpText.addEventListener('click', () => {
      if(step!==1) return;
      helpWrap.classList.add('active');
      setStage('stage-help');
      step=3;
  });

  /* ===== Back‑tap area ===== */
  document.addEventListener('click', async (e)=>{
      const {clientX:x, clientY:y}=e;
      const vw=innerWidth, vh=innerHeight;
      const backZone = x<=vw*0.0637 && y>=vh*0.285 && y<=vh*0.84;
      if(!backZone) return;

      
      if(step===1){
          /* reverse util -> login */
          fadeOutEls([openText, helpText]).then(()=>{
               setStage('stage-util-pre');
               setTimeout(()=>{ setStage('stage-login'); }, 10);
          });
          step = 0;

      }else if(step===2){         /* account -> util */
          accountWrap.classList.remove('active');
          setStage('stage-util');
          step=1;
      }else if(step===3){         /* help -> util */
          helpWrap.classList.remove('active');
          setStage('stage-util');
          step=1;
      }
  });

  /* ===== Editable text logic (unchanged) ===== */
  const editableSel = '.username, .password, .account-text, .help-text-area';
  function findEditable(ev){
    let el = ev.target.closest(editableSel);
    if(!el){
      const alt = document.elementFromPoint(ev.clientX, ev.clientY);
      if(alt) el = alt.closest(editableSel);
    }
    return el;
  }

  document.addEventListener('pointerdown', (ev)=>{
    const el = findEditable(ev);
    if(!el) return;

    // skip send link
    if(/send\s*l1nk/i.test(el.textContent) || /send\s*link/i.test(el.textContent) ||
       el.classList.contains('send-link') || el.id === 'send-link') return;

    if(el.isContentEditable) return;
    ev.preventDefault();
    el.dataset.placeholder = el.textContent;
    el.textContent = '';
    el.setAttribute('contenteditable','true');
    el.focus({preventScroll:true});
  }, true);

  document.addEventListener('focusout', (ev)=>{
    const el = ev.target;
    if(!el || !el.matches || !el.matches(editableSel) || !el.isContentEditable) return;
    if(el.textContent.trim()===''){
      el.textContent = el.dataset.placeholder || '';
      el.removeAttribute('contenteditable');
    }
  }, true);

  /* ===== Edge‑click fullscreen toggle ===== */
  function toggleFullScreen(){
    if(!document.fullscreenElement){
      document.documentElement.requestFullscreen().catch(()=>{});
    }else{
      document.exitFullscreen().catch(()=>{});
    }
  }
  document.addEventListener('click', (ev) => {
    const x = ev.clientX, y = ev.clientY;
    if (x <= 11 || x >= innerWidth - 11 || y <= 11 || y >= innerHeight - 11) {
      toggleFullScreen();
    }
  });
});
</script>
</body>
</html>
